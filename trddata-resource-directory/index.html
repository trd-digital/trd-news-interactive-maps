<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Directory of Real Estate Data Sites</title>
  
  <!-- Google Fonts (Merriweather) -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome (for icons) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <!-- Papa Parse CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  
  <style>
    /* Base colors for light mode */
    :root {
      --background-color: #ffffff;
      --text-color: #000000;
      --accent-color: #007BFF;
      --card-background: #f9f9f9;
      --input-border: #ccc;
    }
    
    /* Dark mode adjustments */
    @media (prefers-color-scheme: dark) {
      :root {
        --background-color: #121212;
        --text-color: #ffffff;
        --card-background: #1e1e1e;
        --input-border: #444;
      }
    }
    
    /* Global styles */
    body {
      margin: 0;
      font-family: 'Merriweather', serif;
      background-color: var(--background-color);
      color: var(--text-color);
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }
    
    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .branding {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }
    
    h1 {
      margin: 0;
      font-size: 1.8em;
      font-weight: 700;
    }
    
    .tagline {
      font-size: 1em;
      opacity: 0.8;
      margin-top: 5px;
      text-align: center;
      max-width: 600px;
    }
    
    .intro {
      font-size: 1em;
      margin-top: 10px;
      text-align: center;
      max-width: 600px;
    }
    
    .sticky-search {
      position: sticky;
      top: 0;
      z-index: 1000;
      background-color: var(--background-color);
      width: 100%;
      padding: 10px 0;
      transition: all 0.3s ease;
    }
    
    .sticky-search.shrink {
      padding: 5px 0;
    }
    
    .search-controls {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      gap: 10px;
    }
    
    .search-controls input {
      flex: 2;
      padding: 10px 15px;
      font-size: 1em;
      border: 1px solid var(--input-border);
      border-radius: 4px;
      background-color: var(--card-background);
      color: var(--text-color);
      transition: border 0.3s, box-shadow 0.3s;
    }
    
    .search-controls select {
      flex: 1;
      padding: 10px 15px;
      font-size: 1em;
      border: 1px solid var(--input-border);
      border-radius: 4px;
      background-color: var(--card-background);
      color: var(--text-color);
      transition: border 0.3s, box-shadow 0.3s;
    }
    
    .search-controls input:focus,
    .search-controls select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 5px var(--accent-color);
    }
    
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 30px;
      padding: 0 10px;
    }
    
    .card {
      background-color: var(--card-background);
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s, box-shadow 0.2s;
      display: flex;
      flex-direction: column;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    
    .card-header {
      background: linear-gradient(135deg, #0053a4, #007BFF);
      color: #fff;
      padding: 10px;
      border-radius: 6px 6px 0 0;
      font-size: 1.2em;
      font-weight: 700;
      margin: -15px -15px 15px -15px;
      text-align: center;
    }
    
    .card-header a {
      color: #fff;
      text-decoration: none;
    }
    
    .category, .source-type {
      font-size: 0.9em;
      margin-bottom: 10px;
      opacity: 0.8;
    }
    
    .card p {
      margin: 8px 0;
      line-height: 1.5;
    }
    
    .divider {
      border-top: 1px solid #ccc;
      margin: 10px 0;
    }
    
    .badge {
      display: inline-block;
      background-color: #6c757d;
      color: #fff;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      margin-right: 6px;
    }
    
    .badge-residential {
      background-color: #28a745;
    }
    .badge-commercial {
      background-color: #ff5733;
    }
    
    .badge-government {
      background-color: #2c3e50;
    }
    .badge-nongovernment {
      background-color: #16a085;
    }
    
    .image-container {
      margin-top: 15px;
      text-align: center;
    }
    .image-container img {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
    }
    
    footer {
      text-align: center;
      margin-top: 40px;
      font-size: 0.8em;
      opacity: 0.8;
      padding: 20px 0;
      border-top: 1px solid #444;
    }
  </style>
</head>
<body>
  <header>
    <div class="branding">
      <h1>Directory of Real Estate Data Sites</h1>
      <p class="tagline">
        Explore a wide range of real estate data sources for research, analysis, and insights.
      </p>
      <p class="intro">
        TRD Data’s one‑stop resource for real estate data. The list links directly to reports and analytics from other data providers, trade groups, brokerages and government sources. See anything missing? Email <a href="mailto:research@therealdeal.com">research@therealdeal.com</a>
      </p>
    </div>
  </header>
  
  <div class="sticky-search" id="stickySearch">
    <div class="search-controls">
      <input type="text" id="searchInput" placeholder="Search by name or description..." />
      <select id="sourceTypeFilter">
        <option value="">All Source Types</option>
      </select>
      <select id="categoryFilter">
        <option value="">All Categories</option>
      </select>
    </div>
  </div>
  
  <main>
    <div class="card-grid" id="resourceContainer"></div>
  </main>
  
  <footer>
    &copy; 2025 Directory of Real Estate Data Sites
  </footer>
  
  <script>
    let resources = [];
    
    const resourceContainer = document.getElementById('resourceContainer');
    const searchInput = document.getElementById('searchInput');
    const categoryFilterSelect = document.getElementById('categoryFilter');
    const sourceTypeFilterSelect = document.getElementById('sourceTypeFilter');
    const stickySearch = document.getElementById('stickySearch');
    
    // Build image path using the resource name directly.
    function getImagePath(name) {
      return 'Logos for Research Directory/' + name + '.png';
    }
    
    function createCategoryBadge(category) {
      const badge = document.createElement('span');
      badge.classList.add('badge');
      if (category.toLowerCase().includes('residential')) {
        badge.classList.add('badge-residential');
      } else if (category.toLowerCase().includes('commercial')) {
        badge.classList.add('badge-commercial');
      }
      badge.textContent = category;
      return badge;
    }
    
    function createSourceTypeBadge(sourceType) {
      const badge = document.createElement('span');
      badge.classList.add('badge');
      if (sourceType.toLowerCase() === 'government') {
        badge.classList.add('badge-government');
      } else if (sourceType.toLowerCase() === 'non-government') {
        badge.classList.add('badge-nongovernment');
      }
      badge.textContent = sourceType;
      return badge;
    }
    
    function renderResources(filterText = '', filterSourceType = '', filterCategory = '') {
      resourceContainer.innerHTML = '';
      
      const filteredResources = resources.filter(resource => {
        const searchTarget = (
          resource["Name"] + ' ' +
          resource["Data type"] + ' ' +
          resource["Description"]
        ).toLowerCase();
        return searchTarget.includes(filterText.toLowerCase()) &&
               (!filterSourceType || resource["Source Type"].toLowerCase() === filterSourceType.toLowerCase()) &&
               (!filterCategory || resource["Data type"].toLowerCase() === filterCategory.toLowerCase());
      });
      
      // Sort alphabetically using the "Name" field.
      filteredResources.sort((a, b) => a["Name"].localeCompare(b["Name"]));
      
      filteredResources.forEach(resource => {
        const card = document.createElement('div');
        card.className = 'card';
        
        const headerDiv = document.createElement('div');
        headerDiv.className = 'card-header';
        const headerLink = document.createElement('a');
        headerLink.href = resource["Research URL"];
        headerLink.target = '_blank';
        headerLink.rel = 'noopener noreferrer';
        headerLink.textContent = resource["Name"];
        headerDiv.appendChild(headerLink);
        card.appendChild(headerDiv);
        
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'category';
        categoryDiv.appendChild(createCategoryBadge(resource["Data type"]));
        card.appendChild(categoryDiv);
        
        const sourceTypeDiv = document.createElement('div');
        sourceTypeDiv.className = 'source-type';
        sourceTypeDiv.appendChild(createSourceTypeBadge(resource["Source Type"]));
        card.appendChild(sourceTypeDiv);
        
        const descriptionPara = document.createElement('p');
        descriptionPara.textContent = resource["Description"];
        card.appendChild(descriptionPara);
        
        if (resource["Use Case"]) {
          const divider = document.createElement('div');
          divider.className = 'divider';
          card.appendChild(divider);
          
          const useCasePara = document.createElement('p');
          useCasePara.textContent = resource["Use Case"];
          card.appendChild(useCasePara);
        }
        
        if (resource["Brokerage type"] && resource["Brokerage type"] !== 'N/A') {
          const brokeragePara = document.createElement('p');
          brokeragePara.textContent = `Brokerage Type: ${resource["Brokerage type"]}`;
          card.appendChild(brokeragePara);
        }
        
        const imageContainer = document.createElement('div');
        imageContainer.className = 'image-container';
        const img = document.createElement('img');
        img.src = getImagePath(resource["Name"]);
        img.alt = resource["Name"] + ' logo';
        img.onerror = function() { this.style.display = 'none'; };
        imageContainer.appendChild(img);
        card.appendChild(imageContainer);
        
        resourceContainer.appendChild(card);
      });
    }
    
    function populateCategoryFilter() {
      const categoriesSet = new Set();
      resources.forEach(resource => {
        if (resource["Data type"]) {
          categoriesSet.add(resource["Data type"].trim());
        }
      });
      Array.from(categoriesSet).sort().forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categoryFilterSelect.appendChild(option);
      });
    }
    
    function populateSourceTypeFilter() {
      const sourceTypes = new Set();
      resources.forEach(resource => {
        if (resource["Source Type"]) {
          sourceTypes.add(resource["Source Type"].trim());
        }
      });
      Array.from(sourceTypes).forEach(sourceType => {
        const option = document.createElement('option');
        option.value = sourceType;
        option.textContent = sourceType;
        sourceTypeFilterSelect.appendChild(option);
      });
    }
    
    Papa.parse('trd-data-research-directory-for-webpage - ComboSheet.csv', {
      download: true,
      header: true,
      complete: function(results) {
        resources = results.data;
        populateSourceTypeFilter();
        populateCategoryFilter();
        renderResources();
      },
      error: function(error) {
        console.error("Error parsing CSV:", error);
      }
    });
    
    searchInput.addEventListener('input', () => {
      renderResources(searchInput.value, sourceTypeFilterSelect.value, categoryFilterSelect.value);
    });
    
    sourceTypeFilterSelect.addEventListener('change', () => {
      renderResources(searchInput.value, sourceTypeFilterSelect.value, categoryFilterSelect.value);
    });
    
    categoryFilterSelect.addEventListener('change', () => {
      renderResources(searchInput.value, sourceTypeFilterSelect.value, categoryFilterSelect.value);
    });
    
    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) {
        stickySearch.classList.add('shrink');
      } else {
        stickySearch.classList.remove('shrink');
      }
    });
  </script>
</body>
</html>
